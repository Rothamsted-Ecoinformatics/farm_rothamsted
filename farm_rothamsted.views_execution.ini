<?php

/**
 * @file
 * Provides Views runtime hooks for farm_ui_map.module.
 */

use Drupal\asset\Entity\AssetType;
use Drupal\views\Entity\View;
use Drupal\views\ViewExecutable;

/**
 * Implements hook_views_pre_render().
 *
 * @see farm_ui_map_module_implements_alter()
 */
function farm_ui_map_views_pre_render(ViewExecutable $view) {

    // Build the map render array.
    $map = [
      '#type' => 'farm_map',
      '#map_type' => 'farm_rothamsted_experiment_plots',
    ];
    $map['#map_settings']['farm_rothamsted_experiment_plot_layer']['plan'] = \Drupal::routeMatch()->getRawParameter('plan');

    // Render the map.
    $view->attachment_before['asset_map'] = $map;
  }
}
